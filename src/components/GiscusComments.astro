---
/**
 * Giscus 评论系统组件
 *
 * 基于 GitHub Discussions 的评论系统
 * 需要配置环境变量或传入参数
 *
 * 配置说明：https://giscus.app
 */
interface Props {
  repo?: string;           // GitHub repository (e.g., "user/repo")
  repoId?: string;         // Repository ID
  category?: string;       // Discussion category
  categoryId?: string;     // Category ID
  mapping?: string;        // Mapping method (pathname, url, title, og:title)
  term?: string;           // Term for mapping (optional)
  theme?: string;          // Theme (light, dark, dark_dimmed, dark_high_contrast, etc.)
  lang?: string;           // Language
}

const {
  repo = import.meta.env.GISCUS_REPO || '',
  repoId = import.meta.env.GISCUS_REPO_ID || '',
  category = import.meta.env.GISCUS_CATEGORY || 'General',
  categoryId = import.meta.env.GISCUS_CATEGORY_ID || '',
  mapping = 'pathname',
  theme = 'preferred_color_scheme',
  lang = 'en',
} = Astro.props;

// 检查是否配置了 Giscus
const isConfigured = repo && repoId && categoryId;

if (!isConfigured) {
  console.warn('Giscus is not configured. Please set GISCUS_REPO, GISCUS_REPO_ID, and GISCUS_CATEGORY_ID environment variables.');
}
---

{isConfigured ? (
  <section class="comments-section" aria-labelledby="comments-title">
    <h2 id="comments-title" class="comments-title">Comments</h2>
    <script src="https://giscus.app/client.js"
      data-repo={repo}
      data-repo-id={repoId}
      data-category={category}
      data-category-id={categoryId}
      data-mapping={mapping}
      data-theme={theme}
      data-lang={lang}
      data-loading="lazy"
      crossorigin="anonymous"
      async>
    </script>
  </section>
) : (
  <section class="comments-section" aria-labelledby="comments-title">
    <h2 id="comments-title" class="comments-title">Comments</h2>
    <p class="comments-not-configured">
      Comments are not configured yet. Please set up Giscus to enable comments.
    </p>
  </section>
)}

<style>
  .comments-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid hsl(var(--border));
  }

  .comments-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: hsl(var(--foreground));
  }

  .comments-not-configured {
    padding: 2rem;
    text-align: center;
    color: hsl(var(--muted-foreground));
    background: hsl(var(--muted) / 0.3);
    border-radius: 0.5rem;
  }

  /* Giscus 容器样式调整 */
  :global(.giscus-frame) {
    border-radius: 0.5rem;
  }
</style>
